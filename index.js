const fs = require('fs')
const path = require('path')
const FormData = require('form-data')
const axios = require('axios')

const TEMP_FILE = path.join(__dirname, `${Date.now()}.png`)

// 一段来自客户端的bas64图片数据(如果通过其他方法能直接落盘生成临时文件可不产生base64数据，base64编码可能会增大文件体积)
const imageBase64 = `data:image/png;base64,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0QvRqPL87/PraW048N2MKjzwX/r1L46oT9Wqi00PXIroZOplAMN9unipUqFl/jTByUH1rwyqpDA/cW2x/3iHfjrV7rjxet5+W7nfbtIL60NaHJQ0dkujkUH1/OqAjmbacZCNWFiHIgpLCimigQ+lDWXTfJxgqTbH35Suqmd7a9oFyF0VEpdqYS4KNDXvnPYXTb44JXkjwpSFJlVrV703bxfum2zB6S50d3mR7z6h2HbNPGUx9zphWiMd7zKwzAb1zz8Y/xwe7p16S8G4+euMRnT83X/RpHsMxpnqWOXFddUFNTW3en8uljR0Qe0q0Iasv48vOqhDR6QXJp2P5VItzF13NQeb3QaBlKsIYnOiQ6fv2b+slV6XdjR3+aO0eu3fpmlum53lDraqKenPPataVHauS9LW+F2Sz0qa9Lo6GkslRdX/YWxBcfwb09HUN6k00zmjA93862aYc+Z969W/uzPTBwEAsxH/owEAGCGwAGCEwAKAEQILAEYILAAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGCCwAGCGwAGCEwAKAEQILAEYILAAYIbAAYCRw7ernM30MADArzVu+5mn+Ty4AMMAUAQAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGCCwAGCGwAGCEwAKAEQILAEYILAAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGCCwAGCGwAGCEwAKAEQILAEYILAAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGCCwAGCGwAGCEwAKAEQILAEYILAAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGCCwAGCGwAGCEwAKAEQILAEYILAAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGCCwAGCGwAGCEwAKAEQILAEYILAAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGCCwAGCGwAGCEwAKAEQILAEYILAAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGCCwAGCGwAGCEwAKAEQILAEYILAAYIbAAYITAAoARAgsARggsABghsABghMACgBECCwBGAjN9AMC9EAzc1oL5YwrMH9PtsXl6YP5Y2vv977WF4z7+yoNfcD/uZ3Y/AgunBQO39eADtzR/3p34525r3gweEZAwb/map+9MfTfg/pMz744K865Lkm6O5Sh6c75ujOXo9hiBxf2BESycNXZnnq5cz5UkRW/Nn+GjASYisHAaYcX9jKsIAMAIgYVTgoHb+tO861oYuD3ThwJMicDCKQvmj2n+vDtcJwAnEFg4JeBf33pjjJcu7n+8SuGU2PWuXIoFFxBYADBCYAHACNfBwin/98UDM30IQNYILJxy4zYnXXAHr1YAMEJgAcAIgYVTli68oaULb8z0YQBZYQ4WTsn0D2kD9yNGsABghMACgBECCwBGCCwAGGGRC05hJxdcQmDhFHZywSW8WgHACIEFACMEFk5hJxdcwhwsnMJOLriEESwAGCGwAGCEwAKAEQILAEZY5IJT2MkFlxBYOIWdXHAJr1YAMEJgAcAIgYVT2MkFlzAHC6ewkwsuYQQLAEYILAAYIbAAYITAAoARFrngFHZywSUEFk5hJxdcwqsVAIwQWAAwQmDhFHZywSXMwcIp7OSCSxjBAoARAgsARggsABghsABghEUuOIWdXHAJgYVT2MkFl/BqBQAjBBYAjBBYOIWdXHAJc7BwCju54BJGsABghMACgBECCwBGCCwAGGGRC05hJxdcQmDhFHZywSW8WgHACIEFACMEFk5hJxdcwhwsnMJOLriEESwAGCGwAGCEwAKAEQILAEZY5IJT2MkFlxBYOIWdXHAJr1YAMEJgAcAIgYVT2MkFlzAHC6ewkwsuYQQLAEYILAAYIbAAYITAAoARFrngFHZywSUEFk5hJxdcwqsVAIwQWAAwQmDhFHZywSXMwcIp7OSCSxjBAoARAgsARggsABghsABghEUuOIWdXHAJgYVT2MkFl/BqBQAjBBYAjBBYOIWdXHAJc7BwCju54BJGsABghMACgBECCwBGCCwAGGGRC05hJxdcQmDhFHZywSW8WgHACIEFACMEFk5hJxdcwhwsnMJOLriEESwAGCGwAGCEwAKAEQILAEZY5IJT2MkFlxBYOIWdXHAJr1YAMEJgAcAIgYVT2MkFlzAHC6ewkwsuYQQLAEYILAAYIbAAYITAAoARFrngFHZywSUEFk5hJxdcwqsVAIwQWAAwQmDhFHZywSXMwcIp7OSCSxjBAoARAgsARggsABghsABghEUuOIWdXHAJgYVT2MkFl/BqBQAjBBYAjBBYOIWdXHAJc7BwCju54BJGsABghMACgBECCwBGCCwAGGGRC05hJxdcQmDhFHZywSW8WgHACIEFACMEFk5hJxdcwhwsnMJOLrjk/wHWgAMm/8E/nQAAAABJRU5ErkJggg==`
// base64处理成buffer
const bufferData = imageBase64.replace(/^data:image\/\w+;base64,/, "")
const buffer = Buffer.alloc(Buffer.byteLength(bufferData), bufferData, 'base64')
// 生成临时文件写入磁盘
fs.writeFileSync(TEMP_FILE, buffer)

const form = new FormData()
form.append('binary', fs.createReadStream(TEMP_FILE)) // 读取临时文件
form.append('csrf', '') // 写入csrf值



const options = {
  headers: {
    'user-agent': `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36`,
    origin: 'https://member.bilibili.com',
    referer: 'https://member.bilibili.com/',
    cookie: '' // 配置cookie
  }
}

// 上传文件
axios.post('https://api.bilibili.com/x/article/creative/article/upcover', form, options).then(({ data }) => {
  console.log(data)
  fs.unlinkSync(TEMP_FILE) // 删除临时文件
}).catch(err => {
  fs.unlinkSync(TEMP_FILE) // 删除临时文件
  console.log(err)
})

